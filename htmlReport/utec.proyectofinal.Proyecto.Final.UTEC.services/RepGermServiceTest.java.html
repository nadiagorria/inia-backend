<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RepGermServiceTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in Proyecto-Final-UTEC Coverage Results</a> &gt; <a href="index.source.html" class="el_package">utec.proyectofinal.Proyecto.Final.UTEC.services</a> &gt; <span class="el_source">RepGermServiceTest.java</span></div><h1>RepGermServiceTest.java</h1><pre class="source lang-java linenums">package utec.proyectofinal.Proyecto.Final.UTEC.services;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;

import utec.proyectofinal.Proyecto.Final.UTEC.business.entities.Germinacion;
import utec.proyectofinal.Proyecto.Final.UTEC.business.entities.RepGerm;
import utec.proyectofinal.Proyecto.Final.UTEC.business.entities.TablaGerm;
import utec.proyectofinal.Proyecto.Final.UTEC.business.repositories.RepGermRepository;
import utec.proyectofinal.Proyecto.Final.UTEC.business.repositories.TablaGermRepository;
import utec.proyectofinal.Proyecto.Final.UTEC.dtos.request.RepGermRequestDTO;
import utec.proyectofinal.Proyecto.Final.UTEC.dtos.response.RepGermDTO;

import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Optional;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyLong;
import static org.mockito.Mockito.*;


@ExtendWith(MockitoExtension.class)
@DisplayName(&quot;Tests de RepGermService&quot;)
<span class="fc" id="L33">class RepGermServiceTest {</span>

    @Mock
    private RepGermRepository repGermRepository;

    @Mock
    private TablaGermRepository tablaGermRepository;

    @Mock
    private AnalisisService analisisService;

    @InjectMocks
    private RepGermService repGermService;

    private TablaGerm tablaGerm;
    private Germinacion germinacion;
    private RepGermRequestDTO repGermRequestDTO;
    private RepGerm repGerm;

    @BeforeEach
    void setUp() {
        
<span class="fc" id="L55">        germinacion = new Germinacion();</span>
<span class="fc" id="L56">        germinacion.setAnalisisID(1L);</span>
<span class="fc" id="L57">        germinacion.setActivo(true);</span>

        
<span class="fc" id="L60">        tablaGerm = new TablaGerm();</span>
<span class="fc" id="L61">        tablaGerm.setTablaGermID(1L);</span>
<span class="fc" id="L62">        tablaGerm.setGerminacion(germinacion);</span>
<span class="fc" id="L63">        tablaGerm.setNumeroRepeticiones(4);</span>
<span class="fc" id="L64">        tablaGerm.setNumeroConteos(3);</span>
<span class="fc" id="L65">        tablaGerm.setNumSemillasPRep(100);</span>
<span class="fc" id="L66">        tablaGerm.setFinalizada(false);</span>

        
<span class="fc" id="L69">        repGermRequestDTO = new RepGermRequestDTO();</span>
<span class="fc" id="L70">        repGermRequestDTO.setNormales(Arrays.asList(25, 30, 20)); </span>
<span class="fc" id="L71">        repGermRequestDTO.setAnormales(10);</span>
<span class="fc" id="L72">        repGermRequestDTO.setDuras(5);</span>
<span class="fc" id="L73">        repGermRequestDTO.setFrescas(3);</span>
<span class="fc" id="L74">        repGermRequestDTO.setMuertas(7);</span>

        
<span class="fc" id="L77">        repGerm = new RepGerm();</span>
<span class="fc" id="L78">        repGerm.setRepGermID(1L);</span>
<span class="fc" id="L79">        repGerm.setNumRep(1);</span>
<span class="fc" id="L80">        repGerm.setNormales(Arrays.asList(25, 30, 20));</span>
<span class="fc" id="L81">        repGerm.setAnormales(10);</span>
<span class="fc" id="L82">        repGerm.setDuras(5);</span>
<span class="fc" id="L83">        repGerm.setFrescas(3);</span>
<span class="fc" id="L84">        repGerm.setMuertas(7);</span>
<span class="fc" id="L85">        repGerm.setTotal(100);</span>
<span class="fc" id="L86">        repGerm.setTablaGerm(tablaGerm);</span>
<span class="fc" id="L87">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición - debe crear con todos los datos correctos&quot;)
    void crearRepGerm_debeCrearConTodosLosDatos() {
        
<span class="fc" id="L93">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L94">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(0L);</span>
<span class="fc" id="L95">        when(repGermRepository.save(any(RepGerm.class))).thenReturn(repGerm);</span>
<span class="fc" id="L96">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(Arrays.asList(repGerm));</span>
<span class="fc" id="L97">        when(tablaGermRepository.save(any(TablaGerm.class))).thenReturn(tablaGerm);</span>

        
<span class="fc" id="L100">        RepGermDTO resultado = repGermService.crearRepGerm(1L, repGermRequestDTO);</span>

        
<span class="fc" id="L103">        assertNotNull(resultado, &quot;El resultado no debe ser nulo&quot;);</span>
<span class="fc" id="L104">        assertEquals(1L, resultado.getRepGermID(), &quot;El ID debe ser 1&quot;);</span>
<span class="fc" id="L105">        assertEquals(1, resultado.getNumRep(), &quot;El número de repetición debe ser 1&quot;);</span>
<span class="fc" id="L106">        assertEquals(Arrays.asList(25, 30, 20), resultado.getNormales(), &quot;Los valores normales deben coincidir&quot;);</span>
<span class="fc" id="L107">        assertEquals(10, resultado.getAnormales(), &quot;Las anormales deben ser 10&quot;);</span>
<span class="fc" id="L108">        assertEquals(5, resultado.getDuras(), &quot;Las duras deben ser 5&quot;);</span>
<span class="fc" id="L109">        assertEquals(3, resultado.getFrescas(), &quot;Las frescas deben ser 3&quot;);</span>
<span class="fc" id="L110">        assertEquals(7, resultado.getMuertas(), &quot;Las muertas deben ser 7&quot;);</span>
<span class="fc" id="L111">        assertEquals(100, resultado.getTotal(), &quot;El total debe ser 100&quot;);</span>
<span class="fc" id="L112">        assertEquals(1L, resultado.getTablaGermId(), &quot;El ID de tabla debe ser 1&quot;);</span>

        
<span class="fc" id="L115">        verify(repGermRepository, times(1)).save(any(RepGerm.class));</span>
        
<span class="fc" id="L117">        verify(tablaGermRepository, times(1)).save(any(TablaGerm.class));</span>
<span class="fc" id="L118">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición - debe generar numRep automáticamente&quot;)
    void crearRepGerm_debeGenerarNumRepAutomaticamente() {
        
<span class="fc" id="L124">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L125">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(2L); </span>
        
<span class="fc" id="L127">        RepGerm repGerm3 = new RepGerm();</span>
<span class="fc" id="L128">        repGerm3.setRepGermID(3L);</span>
<span class="fc" id="L129">        repGerm3.setNumRep(3); </span>
<span class="fc" id="L130">        repGerm3.setTablaGerm(tablaGerm);</span>
<span class="fc" id="L131">        repGerm3.setNormales(Arrays.asList(25, 30, 20));</span>
<span class="fc" id="L132">        repGerm3.setTotal(100);</span>
        
<span class="fc" id="L134">        when(repGermRepository.save(any(RepGerm.class))).thenReturn(repGerm3);</span>
<span class="fc" id="L135">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(Arrays.asList(repGerm3));</span>
<span class="fc" id="L136">        when(tablaGermRepository.save(any(TablaGerm.class))).thenReturn(tablaGerm);</span>

        
<span class="fc" id="L139">        RepGermDTO resultado = repGermService.crearRepGerm(1L, repGermRequestDTO);</span>

        
<span class="fc" id="L142">        assertEquals(3, resultado.getNumRep(), &quot;El numRep debe ser 3 (siguiente disponible)&quot;);</span>
        
<span class="fc" id="L144">        verify(repGermRepository, times(2)).countByTablaGermId(1L);</span>
<span class="fc" id="L145">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición - debe validar número máximo de repeticiones&quot;)
    void crearRepGerm_debeValidarNumeroMaximoRepeticiones() {
        
<span class="fc" id="L151">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L152">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(4L); </span>

        
<span class="fc" id="L155">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L156">            repGermService.crearRepGerm(1L, repGermRequestDTO);</span>
<span class="nc" id="L157">        });</span>

<span class="fc" id="L159">        assertTrue(exception.getMessage().contains(&quot;No se pueden agregar más repeticiones&quot;),</span>
                &quot;Debe lanzar excepción por exceder número máximo de repeticiones&quot;);
<span class="fc" id="L161">        verify(repGermRepository, never()).save(any(RepGerm.class));</span>
<span class="fc" id="L162">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición - debe validar tabla no encontrada&quot;)
    void crearRepGerm_debeValidarTablaNoEncontrada() {
        
<span class="fc" id="L168">        when(tablaGermRepository.findById(999L)).thenReturn(Optional.empty());</span>

        
<span class="fc" id="L171">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L172">            repGermService.crearRepGerm(999L, repGermRequestDTO);</span>
<span class="nc" id="L173">        });</span>

<span class="fc" id="L175">        assertTrue(exception.getMessage().contains(&quot;Tabla no encontrada&quot;),</span>
                &quot;Debe lanzar excepción cuando la tabla no existe&quot;);
<span class="fc" id="L177">        verify(repGermRepository, never()).save(any(RepGerm.class));</span>
<span class="fc" id="L178">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición - debe validar que el total no exceda el límite máximo (105% tolerancia)&quot;)
    void crearRepGerm_debeValidarLimiteMaximo() {
        
<span class="fc" id="L184">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L185">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(0L);</span>

        
<span class="fc" id="L188">        RepGermRequestDTO requestExcesivo = new RepGermRequestDTO();</span>
<span class="fc" id="L189">        requestExcesivo.setNormales(Arrays.asList(50, 40, 20)); </span>
<span class="fc" id="L190">        requestExcesivo.setAnormales(0);</span>
<span class="fc" id="L191">        requestExcesivo.setDuras(0);</span>
<span class="fc" id="L192">        requestExcesivo.setFrescas(0);</span>
<span class="fc" id="L193">        requestExcesivo.setMuertas(0);</span>

        
<span class="fc" id="L196">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L197">            repGermService.crearRepGerm(1L, requestExcesivo);</span>
<span class="nc" id="L198">        });</span>

<span class="fc" id="L200">        assertTrue(exception.getMessage().contains(&quot;excede el límite máximo permitido&quot;),</span>
                &quot;Debe lanzar excepción cuando el total excede el límite máximo&quot;);
<span class="fc" id="L202">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición - debe validar valores negativos en normales&quot;)
    void crearRepGerm_debeValidarValoresNegativosEnNormales() {
        
<span class="fc" id="L208">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L209">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(0L);</span>

<span class="fc" id="L211">        RepGermRequestDTO requestNegativo = new RepGermRequestDTO();</span>
<span class="fc" id="L212">        requestNegativo.setNormales(Arrays.asList(25, -10, 20)); </span>
<span class="fc" id="L213">        requestNegativo.setAnormales(10);</span>

        
<span class="fc" id="L216">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L217">            repGermService.crearRepGerm(1L, requestNegativo);</span>
<span class="nc" id="L218">        });</span>

<span class="fc" id="L220">        assertTrue(exception.getMessage().contains(&quot;no puede ser negativo&quot;),</span>
                &quot;Debe lanzar excepción cuando hay valores negativos en normales&quot;);
<span class="fc" id="L222">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición - debe validar valores negativos en anormales&quot;)
    void crearRepGerm_debeValidarValoresNegativosEnAnormales() {
        
<span class="fc" id="L228">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L229">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(0L);</span>

<span class="fc" id="L231">        RepGermRequestDTO requestNegativo = new RepGermRequestDTO();</span>
<span class="fc" id="L232">        requestNegativo.setNormales(Arrays.asList(25, 30, 20));</span>
<span class="fc" id="L233">        requestNegativo.setAnormales(-5); </span>

        
<span class="fc" id="L236">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L237">            repGermService.crearRepGerm(1L, requestNegativo);</span>
<span class="nc" id="L238">        });</span>

<span class="fc" id="L240">        assertTrue(exception.getMessage().contains(&quot;anormales no puede ser negativo&quot;),</span>
                &quot;Debe lanzar excepción cuando anormales es negativo&quot;);
<span class="fc" id="L242">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición - debe validar valores que exceden numSemillasPRep&quot;)
    void crearRepGerm_debeValidarValoresQueExcedenNumSemillasPRep() {
        
<span class="fc" id="L248">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L249">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(0L);</span>

<span class="fc" id="L251">        RepGermRequestDTO requestExcesivo = new RepGermRequestDTO();</span>
<span class="fc" id="L252">        requestExcesivo.setNormales(Arrays.asList(25, 30, 20));</span>
<span class="fc" id="L253">        requestExcesivo.setAnormales(150); </span>

        
<span class="fc" id="L256">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L257">            repGermService.crearRepGerm(1L, requestExcesivo);</span>
<span class="nc" id="L258">        });</span>

<span class="fc" id="L260">        assertTrue(exception.getMessage().contains(&quot;no puede exceder&quot;),</span>
                &quot;Debe lanzar excepción cuando un valor individual excede numSemillasPRep&quot;);
<span class="fc" id="L262">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición - debe rechazar total cero&quot;)
    void crearRepGerm_debeRechazarTotalCero() {
        
<span class="fc" id="L268">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L269">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(0L);</span>

<span class="fc" id="L271">        RepGermRequestDTO requestVacio = new RepGermRequestDTO();</span>
<span class="fc" id="L272">        requestVacio.setNormales(Arrays.asList(0, 0, 0));</span>
<span class="fc" id="L273">        requestVacio.setAnormales(0);</span>
<span class="fc" id="L274">        requestVacio.setDuras(0);</span>
<span class="fc" id="L275">        requestVacio.setFrescas(0);</span>
<span class="fc" id="L276">        requestVacio.setMuertas(0);</span>

        
<span class="fc" id="L279">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L280">            repGermService.crearRepGerm(1L, requestVacio);</span>
<span class="nc" id="L281">        });</span>

<span class="fc" id="L283">        assertTrue(exception.getMessage().contains(&quot;Debe ingresar al menos un valor&quot;),</span>
                &quot;Debe lanzar excepción cuando el total es cero&quot;);
<span class="fc" id="L285">    }</span>

    @Test
    @DisplayName(&quot;Actualizar repetición - debe actualizar correctamente todos los campos&quot;)
    void actualizarRepGerm_debeActualizarCorrectamente() {
        
<span class="fc" id="L291">        when(repGermRepository.findById(1L)).thenReturn(Optional.of(repGerm));</span>
        
<span class="fc" id="L293">        RepGermRequestDTO requestActualizado = new RepGermRequestDTO();</span>
<span class="fc" id="L294">        requestActualizado.setNormales(Arrays.asList(30, 35, 25)); </span>
<span class="fc" id="L295">        requestActualizado.setAnormales(5);</span>
<span class="fc" id="L296">        requestActualizado.setDuras(2);</span>
<span class="fc" id="L297">        requestActualizado.setFrescas(1);</span>
<span class="fc" id="L298">        requestActualizado.setMuertas(2);</span>
        
<span class="fc" id="L300">        RepGerm repGermActualizada = new RepGerm();</span>
<span class="fc" id="L301">        repGermActualizada.setRepGermID(1L);</span>
<span class="fc" id="L302">        repGermActualizada.setNumRep(1);</span>
<span class="fc" id="L303">        repGermActualizada.setNormales(Arrays.asList(30, 35, 25));</span>
<span class="fc" id="L304">        repGermActualizada.setAnormales(5);</span>
<span class="fc" id="L305">        repGermActualizada.setDuras(2);</span>
<span class="fc" id="L306">        repGermActualizada.setFrescas(1);</span>
<span class="fc" id="L307">        repGermActualizada.setMuertas(2);</span>
<span class="fc" id="L308">        repGermActualizada.setTotal(100); </span>
<span class="fc" id="L309">        repGermActualizada.setTablaGerm(tablaGerm);</span>
        
<span class="fc" id="L311">        when(repGermRepository.save(any(RepGerm.class))).thenReturn(repGermActualizada);</span>
<span class="fc" id="L312">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(Arrays.asList(repGermActualizada));</span>
<span class="fc" id="L313">        when(tablaGermRepository.save(any(TablaGerm.class))).thenReturn(tablaGerm);</span>
<span class="fc" id="L314">        doNothing().when(analisisService).manejarEdicionAnalisisFinalizado(any(Germinacion.class));</span>

        
<span class="fc" id="L317">        RepGermDTO resultado = repGermService.actualizarRepGerm(1L, requestActualizado);</span>

        
<span class="fc" id="L320">        assertNotNull(resultado, &quot;El resultado no debe ser nulo&quot;);</span>
<span class="fc" id="L321">        assertEquals(Arrays.asList(30, 35, 25), resultado.getNormales(), &quot;Los valores normales deben actualizarse&quot;);</span>
<span class="fc" id="L322">        assertEquals(5, resultado.getAnormales(), &quot;Las anormales deben actualizarse&quot;);</span>
<span class="fc" id="L323">        assertEquals(2, resultado.getDuras(), &quot;Las duras deben actualizarse&quot;);</span>
<span class="fc" id="L324">        assertEquals(1, resultado.getFrescas(), &quot;Las frescas deben actualizarse&quot;);</span>
<span class="fc" id="L325">        assertEquals(2, resultado.getMuertas(), &quot;Las muertas deben actualizarse&quot;);</span>
<span class="fc" id="L326">        assertEquals(100, resultado.getTotal(), &quot;El total debe recalcularse correctamente&quot;);</span>

<span class="fc" id="L328">        verify(repGermRepository, times(1)).save(any(RepGerm.class));</span>
<span class="fc" id="L329">        verify(tablaGermRepository, times(1)).save(any(TablaGerm.class));</span>
<span class="fc" id="L330">        verify(analisisService, times(1)).manejarEdicionAnalisisFinalizado(any(Germinacion.class));</span>
<span class="fc" id="L331">    }</span>

    @Test
    @DisplayName(&quot;Actualizar repetición - debe validar repetición no encontrada&quot;)
    void actualizarRepGerm_debeValidarRepeticionNoEncontrada() {
        
<span class="fc" id="L337">        when(repGermRepository.findById(999L)).thenReturn(Optional.empty());</span>

        
<span class="fc" id="L340">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L341">            repGermService.actualizarRepGerm(999L, repGermRequestDTO);</span>
<span class="nc" id="L342">        });</span>

<span class="fc" id="L344">        assertTrue(exception.getMessage().contains(&quot;Repetición no encontrada&quot;),</span>
                &quot;Debe lanzar excepción cuando la repetición no existe&quot;);
<span class="fc" id="L346">        verify(repGermRepository, never()).save(any(RepGerm.class));</span>
<span class="fc" id="L347">    }</span>

    @Test
    @DisplayName(&quot;Eliminar repetición - debe eliminar correctamente&quot;)
    void eliminarRepGerm_debeEliminarCorrectamente() {
        
<span class="fc" id="L353">        when(repGermRepository.findById(1L)).thenReturn(Optional.of(repGerm));</span>
<span class="fc" id="L354">        doNothing().when(repGermRepository).deleteById(1L);</span>

        
<span class="fc" id="L357">        repGermService.eliminarRepGerm(1L);</span>

        
<span class="fc" id="L360">        verify(repGermRepository, times(1)).deleteById(1L);</span>
<span class="fc" id="L361">    }</span>

    @Test
    @DisplayName(&quot;Eliminar repetición - debe validar repetición no encontrada&quot;)
    void eliminarRepGerm_debeValidarRepeticionNoEncontrada() {
        
<span class="fc" id="L367">        when(repGermRepository.findById(999L)).thenReturn(Optional.empty());</span>

        
<span class="fc" id="L370">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L371">            repGermService.eliminarRepGerm(999L);</span>
<span class="nc" id="L372">        });</span>

<span class="fc" id="L374">        assertTrue(exception.getMessage().contains(&quot;Repetición no encontrada&quot;),</span>
                &quot;Debe lanzar excepción cuando la repetición no existe&quot;);
<span class="fc" id="L376">        verify(repGermRepository, never()).deleteById(anyLong());</span>
<span class="fc" id="L377">    }</span>

    @Test
    @DisplayName(&quot;Obtener repetición por ID - debe retornar repetición existente&quot;)
    void obtenerRepGermPorId_debeRetornarRepeticionExistente() {
        
<span class="fc" id="L383">        when(repGermRepository.findById(1L)).thenReturn(Optional.of(repGerm));</span>

        
<span class="fc" id="L386">        RepGermDTO resultado = repGermService.obtenerRepGermPorId(1L);</span>

        
<span class="fc" id="L389">        assertNotNull(resultado, &quot;El resultado no debe ser nulo&quot;);</span>
<span class="fc" id="L390">        assertEquals(1L, resultado.getRepGermID(), &quot;El ID debe coincidir&quot;);</span>
<span class="fc" id="L391">        assertEquals(1, resultado.getNumRep(), &quot;El numRep debe coincidir&quot;);</span>
<span class="fc" id="L392">        verify(repGermRepository, times(1)).findById(1L);</span>
<span class="fc" id="L393">    }</span>

    @Test
    @DisplayName(&quot;Obtener repetición por ID - debe validar repetición no encontrada&quot;)
    void obtenerRepGermPorId_debeValidarRepeticionNoEncontrada() {
        
<span class="fc" id="L399">        when(repGermRepository.findById(999L)).thenReturn(Optional.empty());</span>

        
<span class="fc" id="L402">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L403">            repGermService.obtenerRepGermPorId(999L);</span>
<span class="nc" id="L404">        });</span>

<span class="fc" id="L406">        assertTrue(exception.getMessage().contains(&quot;Repetición no encontrada&quot;),</span>
                &quot;Debe lanzar excepción cuando la repetición no existe&quot;);
<span class="fc" id="L408">    }</span>

    @Test
    @DisplayName(&quot;Obtener repeticiones por tabla - debe retornar lista de repeticiones&quot;)
    void obtenerRepeticionesPorTabla_debeRetornarListaRepeticiones() {
        
<span class="fc" id="L414">        RepGerm rep2 = new RepGerm();</span>
<span class="fc" id="L415">        rep2.setRepGermID(2L);</span>
<span class="fc" id="L416">        rep2.setNumRep(2);</span>
<span class="fc" id="L417">        rep2.setNormales(Arrays.asList(28, 32, 22));</span>
<span class="fc" id="L418">        rep2.setAnormales(8);</span>
<span class="fc" id="L419">        rep2.setDuras(4);</span>
<span class="fc" id="L420">        rep2.setFrescas(2);</span>
<span class="fc" id="L421">        rep2.setMuertas(4);</span>
<span class="fc" id="L422">        rep2.setTotal(100);</span>
<span class="fc" id="L423">        rep2.setTablaGerm(tablaGerm);</span>

<span class="fc" id="L425">        List&lt;RepGerm&gt; repeticiones = Arrays.asList(repGerm, rep2);</span>
<span class="fc" id="L426">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(repeticiones);</span>

        
<span class="fc" id="L429">        List&lt;RepGermDTO&gt; resultado = repGermService.obtenerRepeticionesPorTabla(1L);</span>

        
<span class="fc" id="L432">        assertNotNull(resultado, &quot;El resultado no debe ser nulo&quot;);</span>
<span class="fc" id="L433">        assertEquals(2, resultado.size(), &quot;Debe retornar 2 repeticiones&quot;);</span>
<span class="fc" id="L434">        assertEquals(1, resultado.get(0).getNumRep(), &quot;La primera debe ser numRep 1&quot;);</span>
<span class="fc" id="L435">        assertEquals(2, resultado.get(1).getNumRep(), &quot;La segunda debe ser numRep 2&quot;);</span>
<span class="fc" id="L436">        verify(repGermRepository, times(1)).findByTablaGermId(1L);</span>
<span class="fc" id="L437">    }</span>

    @Test
    @DisplayName(&quot;Obtener repeticiones por tabla - debe retornar lista vacía si no hay repeticiones&quot;)
    void obtenerRepeticionesPorTabla_debeRetornarListaVacia() {
        
<span class="fc" id="L443">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(new ArrayList&lt;&gt;());</span>

        
<span class="fc" id="L446">        List&lt;RepGermDTO&gt; resultado = repGermService.obtenerRepeticionesPorTabla(1L);</span>

        
<span class="fc" id="L449">        assertNotNull(resultado, &quot;El resultado no debe ser nulo&quot;);</span>
<span class="fc" id="L450">        assertEquals(0, resultado.size(), &quot;La lista debe estar vacía&quot;);</span>
<span class="fc" id="L451">    }</span>

    @Test
    @DisplayName(&quot;Contar repeticiones por tabla - debe retornar conteo correcto&quot;)
    void contarRepeticionesPorTabla_debeRetornarConteoCorrecto() {
        
<span class="fc" id="L457">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(3L);</span>

        
<span class="fc" id="L460">        Long resultado = repGermService.contarRepeticionesPorTabla(1L);</span>

        
<span class="fc" id="L463">        assertEquals(3L, resultado, &quot;Debe retornar el conteo correcto&quot;);</span>
<span class="fc" id="L464">        verify(repGermRepository, times(1)).countByTablaGermId(1L);</span>
<span class="fc" id="L465">    }</span>

    @Test
    @DisplayName(&quot;Actualizar totales tabla - debe calcular total como suma de repeticiones&quot;)
    void actualizarTotalesTablaGerm_debeCalcularTotalCorrectamente() {
        
<span class="fc" id="L471">        RepGerm rep1 = new RepGerm();</span>
<span class="fc" id="L472">        rep1.setTotal(100);</span>
<span class="fc" id="L473">        rep1.setNormales(Arrays.asList(25, 30, 20));</span>
<span class="fc" id="L474">        rep1.setAnormales(10);</span>
<span class="fc" id="L475">        rep1.setDuras(5);</span>
<span class="fc" id="L476">        rep1.setFrescas(3);</span>
<span class="fc" id="L477">        rep1.setMuertas(7);</span>
<span class="fc" id="L478">        rep1.setTablaGerm(tablaGerm);</span>

<span class="fc" id="L480">        RepGerm rep2 = new RepGerm();</span>
<span class="fc" id="L481">        rep2.setTotal(98);</span>
<span class="fc" id="L482">        rep2.setNormales(Arrays.asList(28, 32, 22));</span>
<span class="fc" id="L483">        rep2.setAnormales(8);</span>
<span class="fc" id="L484">        rep2.setDuras(3);</span>
<span class="fc" id="L485">        rep2.setFrescas(1);</span>
<span class="fc" id="L486">        rep2.setMuertas(4);</span>
<span class="fc" id="L487">        rep2.setTablaGerm(tablaGerm);</span>

<span class="fc" id="L489">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L490">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(0L);</span>
<span class="fc" id="L491">        when(repGermRepository.save(any(RepGerm.class))).thenReturn(rep1);</span>
<span class="fc" id="L492">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(Arrays.asList(rep1, rep2));</span>
<span class="fc" id="L493">        when(tablaGermRepository.save(any(TablaGerm.class))).thenAnswer(invocation -&gt; {</span>
<span class="fc" id="L494">            TablaGerm tabla = invocation.getArgument(0);</span>
            
<span class="fc" id="L496">            assertEquals(198, tabla.getTotal(), &quot;El total debe ser la suma de las repeticiones&quot;);</span>
<span class="fc" id="L497">            return tabla;</span>
        });

        
<span class="fc" id="L501">        repGermService.crearRepGerm(1L, repGermRequestDTO);</span>

        
<span class="fc" id="L504">        verify(tablaGermRepository, times(1)).save(any(TablaGerm.class));</span>
<span class="fc" id="L505">    }</span>

    @Test
    @DisplayName(&quot;Calcular promedios sin redondeo - debe calcular 5 promedios correctamente&quot;)
    void calcularPromediosSinRedondeo_debeCalcularCorrectamente() {
        
<span class="fc" id="L511">        tablaGerm.setNumeroRepeticiones(4);</span>
        
        
<span class="fc" id="L514">        RepGerm rep1 = crearRepeticion(1, Arrays.asList(25, 30, 20), 10, 5, 3, 7);</span>
<span class="fc" id="L515">        RepGerm rep2 = crearRepeticion(2, Arrays.asList(28, 32, 22), 8, 4, 2, 4);</span>
<span class="fc" id="L516">        RepGerm rep3 = crearRepeticion(3, Arrays.asList(26, 31, 21), 9, 5, 2, 6);</span>
<span class="fc" id="L517">        RepGerm rep4 = crearRepeticion(4, Arrays.asList(27, 29, 23), 11, 3, 4, 3);</span>

<span class="fc" id="L519">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L520">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(3L);</span>
<span class="fc" id="L521">        when(repGermRepository.save(any(RepGerm.class))).thenReturn(rep4);</span>
<span class="fc" id="L522">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(Arrays.asList(rep1, rep2, rep3, rep4));</span>
<span class="fc" id="L523">        when(tablaGermRepository.save(any(TablaGerm.class))).thenAnswer(invocation -&gt; {</span>
<span class="fc" id="L524">            TablaGerm tabla = invocation.getArgument(0);</span>
            
            
<span class="fc" id="L527">            assertNotNull(tabla.getPromedioSinRedondeo(), &quot;Los promedios no deben ser nulos&quot;);</span>
<span class="fc" id="L528">            assertEquals(5, tabla.getPromedioSinRedondeo().size(), &quot;Debe haber 5 promedios&quot;);</span>
            
            
<span class="fc" id="L531">            assertEquals(new BigDecimal(&quot;78.50&quot;), tabla.getPromedioSinRedondeo().get(0), </span>
                    &quot;Promedio de normales debe ser 78.50&quot;);
            
            
<span class="fc" id="L535">            assertEquals(new BigDecimal(&quot;9.50&quot;), tabla.getPromedioSinRedondeo().get(1), </span>
                    &quot;Promedio de anormales debe ser 9.50&quot;);
            
            
<span class="fc" id="L539">            assertEquals(new BigDecimal(&quot;4.25&quot;), tabla.getPromedioSinRedondeo().get(2), </span>
                    &quot;Promedio de duras debe ser 4.25&quot;);
            
            
<span class="fc" id="L543">            assertEquals(new BigDecimal(&quot;2.75&quot;), tabla.getPromedioSinRedondeo().get(3), </span>
                    &quot;Promedio de frescas debe ser 2.75&quot;);
            
            
<span class="fc" id="L547">            assertEquals(new BigDecimal(&quot;5.00&quot;), tabla.getPromedioSinRedondeo().get(4), </span>
                    &quot;Promedio de muertas debe ser 5.00&quot;);
            
<span class="fc" id="L550">            return tabla;</span>
        });

        
<span class="fc" id="L554">        repGermService.crearRepGerm(1L, repGermRequestDTO);</span>

        
<span class="fc" id="L557">        verify(tablaGermRepository, times(1)).save(any(TablaGerm.class));</span>
<span class="fc" id="L558">    }</span>

    @Test
    @DisplayName(&quot;Calcular promedios por conteo - debe calcular promedios por cada conteo individual&quot;)
    void calcularPromediosPorConteo_debeCalcularCorrectamente() {
        
<span class="fc" id="L564">        tablaGerm.setNumeroRepeticiones(4);</span>
<span class="fc" id="L565">        tablaGerm.setNumeroConteos(3);</span>
        
        
<span class="fc" id="L568">        RepGerm rep1 = crearRepeticion(1, Arrays.asList(25, 30, 20), 10, 5, 3, 7);</span>
<span class="fc" id="L569">        RepGerm rep2 = crearRepeticion(2, Arrays.asList(28, 32, 22), 8, 4, 2, 4);</span>
<span class="fc" id="L570">        RepGerm rep3 = crearRepeticion(3, Arrays.asList(26, 31, 21), 9, 5, 2, 6);</span>
<span class="fc" id="L571">        RepGerm rep4 = crearRepeticion(4, Arrays.asList(27, 29, 23), 11, 3, 4, 3);</span>

<span class="fc" id="L573">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L574">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(3L);</span>
<span class="fc" id="L575">        when(repGermRepository.save(any(RepGerm.class))).thenReturn(rep4);</span>
<span class="fc" id="L576">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(Arrays.asList(rep1, rep2, rep3, rep4));</span>
<span class="fc" id="L577">        when(tablaGermRepository.save(any(TablaGerm.class))).thenAnswer(invocation -&gt; {</span>
<span class="fc" id="L578">            TablaGerm tabla = invocation.getArgument(0);</span>
            
            
<span class="fc" id="L581">            assertNotNull(tabla.getPromediosSinRedPorConteo(), &quot;Los promedios por conteo no deben ser nulos&quot;);</span>
<span class="fc" id="L582">            assertEquals(7, tabla.getPromediosSinRedPorConteo().size(), &quot;Debe haber 7 promedios (3 conteos + 4 campos)&quot;);</span>
            
            
<span class="fc" id="L585">            assertEquals(new BigDecimal(&quot;26.50&quot;), tabla.getPromediosSinRedPorConteo().get(0), </span>
                    &quot;Promedio del conteo 1 debe ser 26.50&quot;);
            
            
<span class="fc" id="L589">            assertEquals(new BigDecimal(&quot;30.50&quot;), tabla.getPromediosSinRedPorConteo().get(1), </span>
                    &quot;Promedio del conteo 2 debe ser 30.50&quot;);
            
            
<span class="fc" id="L593">            assertEquals(new BigDecimal(&quot;21.50&quot;), tabla.getPromediosSinRedPorConteo().get(2), </span>
                    &quot;Promedio del conteo 3 debe ser 21.50&quot;);
            
            
<span class="fc" id="L597">            assertEquals(new BigDecimal(&quot;9.50&quot;), tabla.getPromediosSinRedPorConteo().get(3), </span>
                    &quot;Promedio de anormales debe ser 9.50&quot;);
            
            
<span class="fc" id="L601">            assertEquals(new BigDecimal(&quot;4.25&quot;), tabla.getPromediosSinRedPorConteo().get(4), </span>
                    &quot;Promedio de duras debe ser 4.25&quot;);
            
            
<span class="fc" id="L605">            assertEquals(new BigDecimal(&quot;2.75&quot;), tabla.getPromediosSinRedPorConteo().get(5), </span>
                    &quot;Promedio de frescas debe ser 2.75&quot;);
            
            
<span class="fc" id="L609">            assertEquals(new BigDecimal(&quot;5.00&quot;), tabla.getPromediosSinRedPorConteo().get(6), </span>
                    &quot;Promedio de muertas debe ser 5.00&quot;);
            
<span class="fc" id="L612">            return tabla;</span>
        });

        
<span class="fc" id="L616">        repGermService.crearRepGerm(1L, repGermRequestDTO);</span>

        
<span class="fc" id="L619">        verify(tablaGermRepository, times(1)).save(any(TablaGerm.class));</span>
<span class="fc" id="L620">    }</span>

    @Test
    @DisplayName(&quot;Verificar todas las repeticiones completas - debe retornar true cuando están completas&quot;)
    void todasLasRepeticionesCompletas_debeRetornarTrueCuandoCompletas() {
        
<span class="fc" id="L626">        tablaGerm.setNumeroRepeticiones(2);</span>
        
<span class="fc" id="L628">        RepGerm rep1 = crearRepeticion(1, Arrays.asList(25, 30, 20), 10, 5, 3, 7);</span>
<span class="fc" id="L629">        RepGerm rep2 = crearRepeticion(2, Arrays.asList(28, 32, 22), 8, 4, 2, 4);</span>

<span class="fc" id="L631">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L632">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(1L);</span>
<span class="fc" id="L633">        when(repGermRepository.save(any(RepGerm.class))).thenReturn(rep2);</span>
<span class="fc" id="L634">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(Arrays.asList(rep1, rep2));</span>
<span class="fc" id="L635">        when(tablaGermRepository.save(any(TablaGerm.class))).thenAnswer(invocation -&gt; {</span>
<span class="fc" id="L636">            TablaGerm tabla = invocation.getArgument(0);</span>
            
            
<span class="fc" id="L639">            assertNotNull(tabla.getPromedioSinRedondeo(), &quot;Los promedios deben calcularse cuando todas están completas&quot;);</span>
<span class="fc" id="L640">            assertEquals(5, tabla.getPromedioSinRedondeo().size(), &quot;Debe haber 5 promedios&quot;);</span>
            
<span class="fc" id="L642">            return tabla;</span>
        });

        
<span class="fc" id="L646">        repGermService.crearRepGerm(1L, repGermRequestDTO);</span>

        
<span class="fc" id="L649">        verify(tablaGermRepository, times(1)).save(any(TablaGerm.class));</span>
<span class="fc" id="L650">    }</span>

    @Test
    @DisplayName(&quot;Verificar todas las repeticiones completas - debe retornar false cuando faltan repeticiones&quot;)
    void todasLasRepeticionesCompletas_debeRetornarFalseCuandoFaltan() {
        
<span class="fc" id="L656">        tablaGerm.setNumeroRepeticiones(4); </span>
        
<span class="fc" id="L658">        RepGerm rep1 = crearRepeticion(1, Arrays.asList(25, 30, 20), 10, 5, 3, 7);</span>

<span class="fc" id="L660">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L661">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(0L);</span>
<span class="fc" id="L662">        when(repGermRepository.save(any(RepGerm.class))).thenReturn(rep1);</span>
<span class="fc" id="L663">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(Arrays.asList(rep1)); </span>
<span class="fc" id="L664">        when(tablaGermRepository.save(any(TablaGerm.class))).thenAnswer(invocation -&gt; {</span>
<span class="fc" id="L665">            TablaGerm tabla = invocation.getArgument(0);</span>
            
            
<span class="pc bpc" id="L668" title="3 of 4 branches missed.">            assertTrue(tabla.getPromedioSinRedondeo() == null || tabla.getPromedioSinRedondeo().isEmpty(),</span>
                    &quot;No deben calcularse promedios cuando faltan repeticiones&quot;);
            
<span class="fc" id="L671">            return tabla;</span>
        });

        
<span class="fc" id="L675">        repGermService.crearRepGerm(1L, repGermRequestDTO);</span>

        
<span class="fc" id="L678">        verify(tablaGermRepository, times(1)).save(any(TablaGerm.class));</span>
<span class="fc" id="L679">    }</span>

    @Test
    @DisplayName(&quot;Mapear entidad a DTO - debe mapear todos los campos correctamente&quot;)
    void mapearEntidadADTO_debeMapeaTodosLosCampos() {
        
<span class="fc" id="L685">        when(repGermRepository.findById(1L)).thenReturn(Optional.of(repGerm));</span>

        
<span class="fc" id="L688">        RepGermDTO resultado = repGermService.obtenerRepGermPorId(1L);</span>

        
<span class="fc" id="L691">        assertNotNull(resultado, &quot;El DTO no debe ser nulo&quot;);</span>
<span class="fc" id="L692">        assertEquals(repGerm.getRepGermID(), resultado.getRepGermID(), &quot;El ID debe coincidir&quot;);</span>
<span class="fc" id="L693">        assertEquals(repGerm.getNumRep(), resultado.getNumRep(), &quot;El numRep debe coincidir&quot;);</span>
<span class="fc" id="L694">        assertEquals(repGerm.getNormales(), resultado.getNormales(), &quot;Los normales deben coincidir&quot;);</span>
<span class="fc" id="L695">        assertEquals(repGerm.getAnormales(), resultado.getAnormales(), &quot;Las anormales deben coincidir&quot;);</span>
<span class="fc" id="L696">        assertEquals(repGerm.getDuras(), resultado.getDuras(), &quot;Las duras deben coincidir&quot;);</span>
<span class="fc" id="L697">        assertEquals(repGerm.getFrescas(), resultado.getFrescas(), &quot;Las frescas deben coincidir&quot;);</span>
<span class="fc" id="L698">        assertEquals(repGerm.getMuertas(), resultado.getMuertas(), &quot;Las muertas deben coincidir&quot;);</span>
<span class="fc" id="L699">        assertEquals(repGerm.getTotal(), resultado.getTotal(), &quot;El total debe coincidir&quot;);</span>
<span class="fc" id="L700">        assertEquals(repGerm.getTablaGerm().getTablaGermID(), resultado.getTablaGermId(), </span>
                &quot;El ID de tabla debe coincidir&quot;);
<span class="fc" id="L702">    }</span>

    @Test
    @DisplayName(&quot;Crear repetición con valores null - debe asignar valores por defecto&quot;)
    void crearRepGerm_conValoresNull_debeAsignarDefecto() {
        
<span class="fc" id="L708">        RepGermRequestDTO requestConNulls = new RepGermRequestDTO();</span>
<span class="fc" id="L709">        requestConNulls.setNormales(Arrays.asList(75, null, null)); </span>
<span class="fc" id="L710">        requestConNulls.setAnormales(null);</span>
<span class="fc" id="L711">        requestConNulls.setDuras(null);</span>
<span class="fc" id="L712">        requestConNulls.setFrescas(null);</span>
<span class="fc" id="L713">        requestConNulls.setMuertas(null);</span>

<span class="fc" id="L715">        RepGerm repGermConDefectos = new RepGerm();</span>
<span class="fc" id="L716">        repGermConDefectos.setRepGermID(1L);</span>
<span class="fc" id="L717">        repGermConDefectos.setNumRep(1);</span>
<span class="fc" id="L718">        repGermConDefectos.setNormales(Arrays.asList(75, 0, 0)); </span>
<span class="fc" id="L719">        repGermConDefectos.setAnormales(0);</span>
<span class="fc" id="L720">        repGermConDefectos.setDuras(0);</span>
<span class="fc" id="L721">        repGermConDefectos.setFrescas(0);</span>
<span class="fc" id="L722">        repGermConDefectos.setMuertas(0);</span>
<span class="fc" id="L723">        repGermConDefectos.setTotal(75);</span>
<span class="fc" id="L724">        repGermConDefectos.setTablaGerm(tablaGerm);</span>

<span class="fc" id="L726">        when(tablaGermRepository.findById(1L)).thenReturn(Optional.of(tablaGerm));</span>
<span class="fc" id="L727">        when(repGermRepository.countByTablaGermId(1L)).thenReturn(0L);</span>
<span class="fc" id="L728">        when(repGermRepository.save(any(RepGerm.class))).thenReturn(repGermConDefectos);</span>
<span class="fc" id="L729">        when(repGermRepository.findByTablaGermId(1L)).thenReturn(Arrays.asList(repGermConDefectos));</span>
<span class="fc" id="L730">        when(tablaGermRepository.save(any(TablaGerm.class))).thenReturn(tablaGerm);</span>

        
<span class="fc" id="L733">        RepGermDTO resultado = repGermService.crearRepGerm(1L, requestConNulls);</span>

        
<span class="fc" id="L736">        assertEquals(Arrays.asList(75, 0, 0), resultado.getNormales(), </span>
                &quot;Debe completar con 0 los valores null en normales&quot;);
<span class="fc" id="L738">        assertEquals(0, resultado.getAnormales(), &quot;Debe asignar 0 cuando anormales es null&quot;);</span>
<span class="fc" id="L739">        assertEquals(0, resultado.getDuras(), &quot;Debe asignar 0 cuando duras es null&quot;);</span>
<span class="fc" id="L740">        assertEquals(0, resultado.getFrescas(), &quot;Debe asignar 0 cuando frescas es null&quot;);</span>
<span class="fc" id="L741">        assertEquals(0, resultado.getMuertas(), &quot;Debe asignar 0 cuando muertas es null&quot;);</span>
<span class="fc" id="L742">        assertEquals(75, resultado.getTotal(), &quot;El total debe calcularse correctamente&quot;);</span>
<span class="fc" id="L743">    }</span>

    
    private RepGerm crearRepeticion(int numRep, List&lt;Integer&gt; normales, int anormales, 
                                    int duras, int frescas, int muertas) {
<span class="fc" id="L748">        RepGerm rep = new RepGerm();</span>
<span class="fc" id="L749">        rep.setRepGermID((long) numRep);</span>
<span class="fc" id="L750">        rep.setNumRep(numRep);</span>
<span class="fc" id="L751">        rep.setNormales(normales);</span>
<span class="fc" id="L752">        rep.setAnormales(anormales);</span>
<span class="fc" id="L753">        rep.setDuras(duras);</span>
<span class="fc" id="L754">        rep.setFrescas(frescas);</span>
<span class="fc" id="L755">        rep.setMuertas(muertas);</span>
        
<span class="fc" id="L757">        int total = normales.stream().mapToInt(Integer::intValue).sum() + </span>
                   anormales + duras + frescas + muertas;
<span class="fc" id="L759">        rep.setTotal(total);</span>
<span class="fc" id="L760">        rep.setTablaGerm(tablaGerm);</span>
        
<span class="fc" id="L762">        return rep;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>